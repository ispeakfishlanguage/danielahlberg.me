{% extends 'base.html' %}
{% load static %}

{% block title %}Photography Portfolio - Daniel Ahlberg | Stockholm Photographer{% endblock %}
{% block description %}Browse Daniel Ahlberg's photography portfolio featuring stunning portraits, landscapes, and events. Professional photography services in Stockholm, Sweden.{% endblock %}
{% block keywords %}photography portfolio Stockholm, portrait gallery, landscape photography Sweden, event photography portfolio, professional photographer work{% endblock %}

{% block canonical %}{{ request.scheme }}://{{ request.get_host }}{% url 'portfolio:portfolio' %}{% if current_category %}?category={{ current_category }}{% endif %}{% endblock %}

{% block structured_data %}
{
    "@context": "https://schema.org",
    "@type": "ImageGallery",
    "name": "Daniel Ahlberg Photography Portfolio",
    "description": "Professional photography portfolio showcasing portraits, landscapes, and events by Stockholm photographer Daniel Ahlberg",
    "url": "{{ request.build_absolute_uri }}",
    "creator": {
        "@type": "Person",
        "name": "Daniel Ahlberg",
        "jobTitle": "Professional Photographer"
    }
}
{% endblock %}

{% block content %}

<!-- Advanced Portfolio Gallery Section -->
<section class="advanced-portfolio-section">
    <div class="portfolio-container">
        <!-- Portfolio Header -->
        <div class="portfolio-header">
            <h1 class="portfolio-main-title">Portfolio</h1>
            <p class="portfolio-subtitle">Experience the work of Daniel Ahlberg in a curated online exhibition</p>
        </div>

        <!-- Collection Filter Buttons -->
        <div class="filter-container">
            <button class="advanced-filter-btn active" data-filter="all">
                <span>All</span>
            </button>
            <button class="advanced-filter-btn" data-filter="portrait">
                <span>Portrait</span>
            </button>
            <button class="advanced-filter-btn" data-filter="nature">
                <span>Nature</span>
            </button>
            <button class="advanced-filter-btn" data-filter="events">
                <span>Events</span>
            </button>
            <button class="advanced-filter-btn" data-filter="projects">
                <span>Projects</span>
            </button>
        </div>

        <!-- Advanced Portfolio Grid -->
        <div class="advanced-portfolio-grid" id="portfolio-grid">
            {% for photo in photos %}
            <div class="grid-item grid-large-landscape" data-category="{{ photo.category.slug }}" data-delay="{{ forloop.counter0|add:100 }}">
                <img src="{{ photo.image.url }}"
                     alt="{{ photo.title }}" class="grid-image" data-title="{{ photo.title }}" data-description="{{ photo.description|default:'Photo by Daniel Ahlberg' }}" loading="lazy">
                <div class="image-overlay">
                    <div class="overlay-content">
                        <h3>{{ photo.title }}</h3>
                        <p>{{ photo.category.name }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Advanced Lightbox -->
    <div class="advanced-lightbox" id="advanced-lightbox">
        <div class="lightbox-close">&times;</div>
        <div class="lightbox-content">
            <img class="lightbox-image" src="" alt="">
            <div class="lightbox-info">
                <div class="lightbox-title"></div>
                <div class="lightbox-description"></div>
            </div>
            <div class="lightbox-nav">
                <button class="nav-btn prev-btn">‹</button>
                <button class="nav-btn next-btn">›</button>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Advanced Portfolio Gallery with Scroll Animations and Parallax

    // Intersection Observer for scroll-triggered animations
    const observerOptions = {
        root: null,
        rootMargin: '-10% 0px -10% 0px',
        threshold: 0.1
    };

    const portfolioObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const item = entry.target;
                const delay = item.getAttribute('data-delay') || 0;

                setTimeout(() => {
                    item.classList.remove('scroll-animate');
                    item.classList.add('animate-in');
                }, delay);
            }
        });
    }, observerOptions);

    // Parallax effects removed to prevent images from moving during scroll

    // Initialize portfolio items
    const portfolioItems = document.querySelectorAll('.grid-item');
    let visibleItems = Array.from(portfolioItems);

    // Show items with fade-in after images load
    let imagesLoaded = 0;
    const totalImages = portfolioItems.length;

    function checkAllImagesLoaded() {
        if (imagesLoaded === totalImages) {
            // All images loaded, fade them in
            setTimeout(() => {
                portfolioItems.forEach(item => item.classList.add('animate-in'));
            }, 100);
        }
    }

    portfolioItems.forEach((item, index) => {
        const img = item.querySelector('.grid-image');

        // Check if image is already loaded
        if (img.complete) {
            imagesLoaded++;
        } else {
            img.addEventListener('load', function() {
                imagesLoaded++;
                checkAllImagesLoaded();
            });
        }

        // Only observe for scroll animations after initial load
        portfolioObserver.observe(item);
    });

    // Check if all images were already loaded
    checkAllImagesLoaded();

    // Advanced filtering with smooth animations
    const filterBtns = document.querySelectorAll('.advanced-filter-btn');

    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.getAttribute('data-filter');

            // Update active button
            filterBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            // Animate items out first
            portfolioItems.forEach(item => {
                item.classList.add('filtering-out');
            });

            setTimeout(() => {
                // Filter and animate in
                portfolioItems.forEach(item => {
                    const itemCategory = item.getAttribute('data-category');
                    item.classList.remove('filtering-out');

                    if (filter === 'all' || itemCategory === filter) {
                        item.classList.remove('hidden');
                        item.classList.add('visible');
                        // Re-trigger animation
                        setTimeout(() => {
                            item.classList.remove('scroll-animate');
                            item.classList.add('animate-in');
                        }, Math.random() * 300);
                    } else {
                        item.classList.add('hidden');
                        item.classList.remove('visible', 'animate-in');
                    }
                });

                // Update visible items for lightbox
                updateVisibleItems();
            }, 300);
        });
    });

    function updateVisibleItems() {
        const activeFilter = document.querySelector('.advanced-filter-btn.active').getAttribute('data-filter');
        visibleItems = Array.from(portfolioItems).filter(item =>
            !item.classList.contains('hidden')
        );
    }

    // Advanced Lightbox functionality
    let currentIndex = 0;
    const lightbox = document.getElementById('advanced-lightbox');
    const lightboxImage = lightbox.querySelector('.lightbox-image');
    const lightboxTitle = lightbox.querySelector('.lightbox-title');
    const lightboxDescription = lightbox.querySelector('.lightbox-description');
    const closeBtn = lightbox.querySelector('.lightbox-close');
    const prevBtn = lightbox.querySelector('.prev-btn');
    const nextBtn = lightbox.querySelector('.next-btn');

    function openLightbox(index) {
        currentIndex = index;
        updateLightboxContent();
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        lightbox.classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    function updateLightboxContent() {
        const currentItem = visibleItems[currentIndex];
        const img = currentItem.querySelector('.grid-image');
        const title = img.getAttribute('data-title');
        const description = img.getAttribute('data-description');

        // Get high resolution version
        const highResSrc = img.src.replace('w=800', 'w=1600').replace('w=600', 'w=1600').replace('w=700', 'w=1600');

        lightboxImage.src = highResSrc;
        lightboxImage.alt = title;
        lightboxTitle.textContent = title;
        lightboxDescription.textContent = description;

        // Update navigation
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === visibleItems.length - 1;

        // Preload adjacent images
        preloadImages();
    }

    function preloadImages() {
        // Preload next image
        if (currentIndex < visibleItems.length - 1) {
            const nextImg = visibleItems[currentIndex + 1].querySelector('.grid-image');
            const nextHighRes = nextImg.src.replace('w=800', 'w=1600').replace('w=600', 'w=1600').replace('w=700', 'w=1600');
            const preloadNext = new Image();
            preloadNext.src = nextHighRes;
        }

        // Preload previous image
        if (currentIndex > 0) {
            const prevImg = visibleItems[currentIndex - 1].querySelector('.grid-image');
            const prevHighRes = prevImg.src.replace('w=800', 'w=1600').replace('w=600', 'w=1600').replace('w=700', 'w=1600');
            const preloadPrev = new Image();
            preloadPrev.src = prevHighRes;
        }
    }

    function nextImage() {
        if (currentIndex < visibleItems.length - 1) {
            currentIndex++;
            updateLightboxContent();
        }
    }

    function prevImage() {
        if (currentIndex > 0) {
            currentIndex--;
            updateLightboxContent();
        }
    }

    // Event listeners
    portfolioItems.forEach((item, index) => {
        item.addEventListener('click', function() {
            updateVisibleItems();
            const visibleIndex = visibleItems.indexOf(item);
            if (visibleIndex !== -1) {
                openLightbox(visibleIndex);
            }
        });
    });

    closeBtn.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', function(e) {
        if (e.target === lightbox) closeLightbox();
    });

    nextBtn.addEventListener('click', nextImage);
    prevBtn.addEventListener('click', prevImage);

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (lightbox.classList.contains('active')) {
            switch(e.key) {
                case 'Escape':
                    closeLightbox();
                    break;
                case 'ArrowLeft':
                    prevImage();
                    break;
                case 'ArrowRight':
                    nextImage();
                    break;
            }
        }
    });

    // Initialize
    updateVisibleItems();
});
</script>
{% endblock %}